function drawScatterCharts(chartData) {
    const targets = [
        'b0', 'b1', 'weighted_b0', 'weighted_b1',
        'current_b0', 'current_b1', 'if_b0', 'if_b1'
    ];

    targets.forEach(target => {
        const canvasId = `${target}Chart`;
        const ctx = document.getElementById(canvasId);

        if (!ctx) return;

        const rawData = chartData[target];
        if (!rawData || rawData.length === 0) return;

        const grouped = groupBy(rawData, 'variable');

        const datasets = Object.keys(grouped).map(variable => {
            return {
                label: variable,
                data: grouped[variable].map(item => ({ x: item.Date, y: item.value })),
                showLine: false,
                pointRadius: 3,
            };
        });

        // Upper Spec Line
        const upperSpec = rawData.map(item => ({ x: item.Date, y: item.upper_spec }));
        datasets.push({
            label: "Upper Spec",
            data: upperSpec,
            borderColor: "red",
            borderDash: [5, 5],
            fill: false,
            type: "line",
            pointRadius: 0,
            tension: 0
        });

        // Lower Spec Line
        const lowerSpec = rawData.map(item => ({ x: item.Date, y: item.lower_spec }));
        datasets.push({
            label: "Lower Spec",
            data: lowerSpec,
            borderColor: "blue",
            borderDash: [5, 5],
            fill: false,
            type: "line",
            pointRadius: 0,
            tension: 0
        });

        new Chart(ctx, {
            type: 'scatter',
            data: { datasets: datasets },
            options: {
                responsive: true,
                plugins: {
                    legend: { display: true }
                },
                scales: {
                    x: {
                        type: 'time',
                        time: {
                            tooltipFormat: 'yy/MM/dd HH:mm',
                            unit: 'day'
                        },
                        title: { display: true, text: 'Date' }
                    },
                    y: {
                        title: { display: true, text: target }
                    }
                }
            }
        });
    });
}

function groupBy(arr, key) {
    return arr.reduce((acc, item) => {
        const groupKey = item[key];
        if (!acc[groupKey]) acc[groupKey] = [];
        acc[groupKey].push(item);
        return acc;
    }, {});
}
