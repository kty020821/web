document.addEventListener("DOMContentLoaded", function () {
    // 차트가 필요한 페이지에서만 실행
    if (window.chartData && document.getElementById('b0Chart')) {
        drawScatterCharts(window.chartData);
    }

    // 기존 inline.js의 다른 코드들도 여기서 실행
});

function drawScatterCharts(chartData) {
    if (!chartData || !Array.isArray(chartData.b0) || !Array.isArray(chartData.b1)) {
        console.warn("chartData가 유효하지 않음:", chartData);
        return;
    }

    function groupByVariable(data) {
        const grouped = {};
        data.forEach(row => {
            const name = row.variable;
            if (!grouped[name]) grouped[name] = [];
            grouped[name].push({ x: row.Date, y: row.value });
        });
        return grouped;
    }

    function buildDatasets(grouped) {
        return Object.keys(grouped).map(name => ({
            label: name,
            data: grouped[name],
            showLine: false,
            pointRadius: 4
        }));
    }

    const b0Grouped = groupByVariable(chartData.b0 || []);
    const b1Grouped = groupByVariable(chartData.b1 || []);

    new Chart(document.getElementById('b0Chart'), {
        type: 'scatter',
        data: { datasets: buildDatasets(b0Grouped) },
        options: {
            plugins: { title: { display: true, text: 'B0 Scatter Chart' } },
            scales: {
                x: { type: 'time', title: { display: true, text: 'Date' } },
                y: { title: { display: true, text: 'Value' } }
            }
        }
    });

    new Chart(document.getElementById('b1Chart'), {
        type: 'scatter',
        data: { datasets: buildDatasets(b1Grouped) },
        options: {
            plugins: { title: { display: true, text: 'B1 Scatter Chart' } },
            scales: {
                x: { type: 'time', title: { display: true, text: 'Date' } },
                y: { title: { display: true, text: 'Value' } }
            }
        }
    });
}
